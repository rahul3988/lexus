<UserControl x:Class="Lexus2_0.Desktop.Views.TicketView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Padding="10" Background="{StaticResource LightGrey}">
            <TextBlock Text="Ticket Management" 
                      FontSize="18" 
                      FontWeight="Bold" 
                      Foreground="{StaticResource TextWhite}"/>
        </Border>
        
        <!-- Main Panel with Token Info, Date/Time, Checkboxes, and SMS Uploader Link -->
        <Border Grid.Row="1" 
               Background="{StaticResource LightGrey}" 
               Padding="15" 
               Margin="10,10,10,5"
               BorderBrush="{StaticResource PrimaryBlue}"
               BorderThickness="1"
               CornerRadius="3">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Left Column: Token Info and Controls -->
                <StackPanel Grid.Row="0" Grid.Column="0">
                    <Button x:Name="CheckTokenButton" 
                           Content="Check Token" 
                           Style="{StaticResource PrimaryButton}"
                           Click="CheckTokenButton_Click"
                           HorizontalAlignment="Left"
                           Margin="0,0,0,10"
                           Padding="12,6"
                           MinWidth="150"/>
                    
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                        <TextBlock Text="User / Token: " 
                                  Foreground="{StaticResource TextWhite}"
                                  FontSize="13"/>
                        <TextBlock x:Name="UserTokenTextBlock" 
                                  Text="Not Set" 
                                  Foreground="{StaticResource LightBlue}"
                                  FontSize="13"
                                  FontWeight="SemiBold"/>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBlock Text="Valid count: " 
                                  Foreground="{StaticResource TextWhite}"
                                  FontSize="13"/>
                        <TextBlock x:Name="ValidCountTextBlock" 
                                  Text="0" 
                                  Foreground="{StaticResource SuccessGreen}"
                                  FontSize="13"
                                  FontWeight="SemiBold"/>
                    </StackPanel>
                    
                    <!-- Web2 / Web3 Checkboxes -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <CheckBox x:Name="Web2CheckBox" 
                                 Content="Web2" 
                                 Foreground="{StaticResource TextWhite}"
                                 Margin="0,0,15,0"
                                 Checked="WebCheckbox_Changed"
                                 Unchecked="WebCheckbox_Changed"/>
                        <CheckBox x:Name="Web3CheckBox" 
                                 Content="Web3" 
                                 Foreground="{StaticResource TextWhite}"
                                 Checked="WebCheckbox_Changed"
                                 Unchecked="WebCheckbox_Changed"/>
                    </StackPanel>
                    
                    <!-- SMS Uploader Link -->
                    <TextBlock Margin="0,5,0,0">
                        <Hyperlink x:Name="SmsUploaderLink" 
                                  Click="SmsUploaderLink_Click"
                                  Foreground="{StaticResource LightBlue}">
                            Click here to View SMS Uploader
                        </Hyperlink>
                    </TextBlock>
                </StackPanel>
                
                <!-- Right Column: Red Digital Date & Time -->
                <StackPanel Grid.Row="0" Grid.Column="1" HorizontalAlignment="Right">
                    <TextBlock x:Name="DateTimeTextBlock" 
                              FontFamily="Consolas"
                              FontSize="24" 
                              FontWeight="Bold" 
                              Foreground="#FF4444"
                              TextAlignment="Right"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Ticket Table -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Margin="10,0,10,10">
            <DataGrid x:Name="TicketsDataGrid" 
                     ItemsSource="{Binding Tickets}"
                     AutoGenerateColumns="False"
                     Background="{StaticResource DarkGrey}"
                     Foreground="{StaticResource TextWhite}"
                     BorderBrush="{StaticResource PrimaryBlue}"
                     GridLinesVisibility="All"
                     HeadersVisibility="Column"
                     RowBackground="{StaticResource LightGrey}"
                     AlternatingRowBackground="{StaticResource DarkGrey}"
                     CanUserAddRows="False"
                     CanUserDeleteRows="False">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Ticket ID" Binding="{Binding TicketId}" Width="*"/>
                    <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="*"/>
                    <DataGridTextColumn Header="Attempts" Binding="{Binding AttemptCount}" Width="80"/>
                    <DataGridTextColumn Header="Success" Binding="{Binding SuccessCount}" Width="80"/>
                    <DataGridTextColumn Header="Failures" Binding="{Binding FailureCount}" Width="80"/>
                    <DataGridTextColumn Header="Last Updated" Binding="{Binding LastUpdatedTimestamp, StringFormat=yyyy-MM-dd HH:mm:ss}" Width="*"/>
                </DataGrid.Columns>
                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="{StaticResource PrimaryBlue}"/>
                        <Setter Property="Foreground" Value="{StaticResource White}"/>
                        <Setter Property="FontWeight" Value="Bold"/>
                        <Setter Property="Padding" Value="10,5"/>
                    </Style>
                </DataGrid.ColumnHeaderStyle>
                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Setter Property="Foreground" Value="{StaticResource TextWhite}"/>
                        <EventSetter Event="MouseDoubleClick" Handler="TicketRow_DoubleClick"/>
                    </Style>
                </DataGrid.RowStyle>
            </DataGrid>
        </ScrollViewer>
    </Grid>
</UserControl>
